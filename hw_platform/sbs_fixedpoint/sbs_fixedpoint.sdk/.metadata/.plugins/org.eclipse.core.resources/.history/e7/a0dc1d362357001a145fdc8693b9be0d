/************************ Event logger ***************************************/

Timer * SbsLogger_timer = NULL;

static SbsLogger * SbsLogger_new (int num_logs)
{
  SbsLogger * logger = NULL;

  if (SbsLogger_timer == NULL)
    SbsLogger_timer = Timer_new (1);

  ASSERT (SbsLogger_timer != NULL);

  logger = malloc (sizeof(SbsLogger) + (num_logs - 1) * sizeof(Point));

  ASSERT (logger != NULL);

  memset (logger, 0, sizeof(SbsLogger) + (num_logs - 1) * sizeof(Point));

  logger->size = num_logs;
  logger->timer = SbsLogger_timer;

  return logger;
}

static void SbsLogger_delete (SbsLogger ** logger)
{
  ASSERT (logger != NULL);
  ASSERT (*logger != NULL);

  if ((logger != NULL) && (*logger != NULL))
  {
    free (*logger);
    *logger = NULL;
  }
}

inline static void SbsLogger_timeReset (void) __attribute__((always_inline));
inline static void SbsLogger_timeReset (void)
{
  if (SbsLogger_timer == NULL)
    SbsLogger_timer = Timer_new(1);

  Timer_start(SbsLogger_timer);
}

inline static void SbsLogger_logPoint(SbsLogger * logger, double p) __attribute__((always_inline));
inline static void SbsLogger_logPoint(SbsLogger * logger, double p)
{
  ASSERT(logger != NULL);
  logger->point_array[logger->index].time = Timer_getCurrentTime(logger->timer);
  logger->point_array[logger->index].value = p;
  logger->index ++;
  if (logger->size <= logger->index)
    logger->index = 0;
}
